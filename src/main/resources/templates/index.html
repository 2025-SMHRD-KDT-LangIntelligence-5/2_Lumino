<!DOCTYPE html>

<!--문서 기본 언어가 영어임-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

    <head>
        <!-- 공통 메타태그 -->
        <th:block th:replace="~{fragments/head :: common-meta}"></th:block>

        <!--브라우저 탭 제목-->
        <title>A-VERSE</title>

        <!-- 공통 CSS -->
        <th:block th:replace="~{fragments/head :: common-css}"></th:block>

        <!--커스텀 css => 커스텀 스타일 바꿀 때 여기에 써야 반영이 잘 됨.-->
        <link href="/css/main.css" rel="stylesheet" />

        <style>

            /* === 챗봇 버튼 === */
                #chatbot-button {
                  position: fixed;
                  bottom: 25px;
                  right: 30px;
                  width: 70px;
                  height: 80px;
                  border-radius: 50%;
                  cursor: pointer;
                  z-index: 999;
                  box-shadow: 0 6px 20px rgba(150, 120, 255, 0.4);
                  transition: transform 0.3s ease, box-shadow 0.3s ease;
                }
                #chatbot-button img {
                  width: 100%;
                  height: 100%;
                  border-radius: 50%;
                  object-fit: cover;
                }
                #chatbot-button:hover {
                  transform: scale(1.1);
                  box-shadow: 0 0 25px rgba(150, 120, 255, 0.7);
                }

                /* === 챗봇 팝업 === */
                #chatbot-popup {
                  position: fixed;
                  bottom: 110px;
                  right: 40px;
                  width: 520px;
                  height: 720px;
                  background: rgba(255,255,255,0.95);
                  border-radius: 20px;
                  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
                  overflow: hidden;
                  display: none; /* 기본 숨김 */
                  z-index: 1000;
                }

                /* === 챗봇 헤더 === */
                #chatbot-header {
                  background: linear-gradient(135deg, #b39aff, #8ca6ff, #b7e8ff);
                  color: white;
                  font-weight: 600;
                  padding: 12px 16px;
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                }
                #chatbot-header button {
                  background: none;
                  border: none;
                  font-size: 1.2rem;
                  color: white;
                  cursor: pointer;
                }

                /* === 챗봇 본문 === */
                #chatbot-body {
                  width: 100%;
                  height: calc(100% - 48px);
                }
                #chatbot-body iframe {
                  width: 100%;
                  height: 100%;
                  border: none;
                  border-radius: 0 0 20px 20px;
                }


                /* 모드 이미지 버튼 (이미지만 보이게) */
                .mode-btn{
                  all: unset;                  /* 기본 버튼 스타일 제거 */
                  display: flex !important;
                  align-items: center;
                  justify-content: center;
                  width: 6rem;              /* 크기 조정: 더 키우려면 값만 늘리세요 */
                  height: 4.25rem;
                  cursor: pointer;
                  margin: 0 auto;              /* 가운데 정렬 */
                }
                .mode-btn img{
                  width: 100%;
                  height: 100%;
                  display: block;
                  border-radius: 18px;         /* 이미지 모서리 살짝 라운드 (원한다면 0으로) */
                  pointer-events: none;        /* 클릭 판정은 버튼이 받도록 */
                }

                /* 호버 시 살짝 글로우 */
                .mode-btn:hover{
                  filter: drop-shadow(0 0 12px rgba(161,139,255,.55));
                  transform: translateZ(0);
                }

            /* === 검색창 전체 래퍼 === */
                .search-bar {
                  max-width: 900px;
                  width: 100%;
                  border-radius: 50px;
                  overflow: hidden;
                  background: rgba(255,255,255,0.3);
                  backdrop-filter: blur(12px);
                  border: 2px solid transparent;
                  background-image:
                    linear-gradient(rgba(255,255,255,0.25), rgba(255,255,255,0.25)),
                    linear-gradient(135deg, #b39aff, #8da6ff, #b7e8ff);
                  background-origin: border-box;
                  background-clip: content-box, border-box;
                  transition: all 0.4s ease;
                  box-shadow: 0 0 20px rgba(150,120,255,0.15);
                }

                /* === 입력창 === */
                .search-input {
                  border: none !important;
                  background: white !important;
                  padding: 0.8rem 1.2rem;
                  font-size: 1rem;
                  color: #3a3a3a;
                  width: 100%;
                  transition: all 0.3s ease;
                }
                .search-input::placeholder {
                  color: #aaa;
                  letter-spacing: 0.5px;
                }
                .search-input:focus {
                  outline: none;
                  color: #222;
                }

                /* === 아이콘 영역 === */
                .search-icon {
                  border: none !important;
                  background: transparent !important;
                  padding-right: 1.2rem;
                  color: #7d6aff;
                  transition: all 0.3s ease;
                }

                /* === 포커스 시 효과 (빛나는 오로라 테두리) === */
                .search-bar:focus-within {
                  background-image:
                    linear-gradient(rgba(255,255,255,0.25), rgba(255,255,255,0.25)),
                    linear-gradient(135deg, #c6b0ff, #b7e8ff, #91a8ff);
                  box-shadow: 0 0 25px rgba(150,120,255,0.35);
                  transform: scale(1.02);
                }

                /* === 엔터(Submit) 시 시각적 반응 === */
                .search-input:focus:valid {
                  animation: enterPulse 0.3s ease-out;
                }
                @keyframes enterPulse {
                  0%   { box-shadow: 0 0 0 rgba(150,120,255,0); }
                  50%  { box-shadow: 0 0 15px rgba(150,120,255,0.4); }
                  100% { box-shadow: 0 0 0 rgba(150,120,255,0); }
                }

            /* 엔터(Submit) 시 시각적 반응 */
                .enter-pulse {
                  animation: enterPulse 0.35s ease-out;
                }
                @keyframes enterPulse {
                  0%   { box-shadow: 0 0 0 rgba(150,120,255,0); }
                  50%  { box-shadow: 0 0 16px rgba(150,120,255,0.45); }
                  100% { box-shadow: 0 0 0 rgba(150,120,255,0); }
                }

            /* === A-VERSE 감성 디테일 (라이트/다크 공통으로 덮어쓰기) === */

                /* 1) 네비게이션/사이드바 글래스 질감 */
                .topnav,
                .sidenav {
                  backdrop-filter: blur(12px);
                  -webkit-backdrop-filter: blur(12px);
                }
                body[data-theme="light"] .topnav,
                body[data-theme="light"] .sidenav {
                  background: rgba(255,255,255,0.60);
                  border: 1px solid rgba(180,180,255,0.20);
                  box-shadow: 0 6px 18px rgba(160,140,255,0.10);
                }
                body[data-theme="dark"] .topnav,
                body[data-theme="dark"] .sidenav {
                  background: rgba(20,20,35,0.45);
                  border: 1px solid rgba(160,160,220,0.12);
                  box-shadow: 0 8px 24px rgba(10,10,20,0.45);
                }

                /* 3) 카드 부유감 */
                .card.lift:hover {
                  transform: translateY(-4px);
                  box-shadow: 0 10px 28px rgba(160,140,255,0.22);
                }

                /* 6) 페이지 헤더(로고 영역) 글로시 오버레이 */
                .page-header {
                  position: relative; overflow: hidden;
                }
                .page-header::after{
                  content:"";
                  position:absolute; inset:0;
                  background:
                    radial-gradient(600px 180px at 10% -10%, rgba(179,154,255,0.15), transparent 60%),
                    radial-gradient(500px 160px at 85% -10%, rgba(141,166,255,0.12), transparent 60%);
                  pointer-events: none;
                }

                /* 7) 버튼/링크 호버 오로라 흐름 */
                .btn:hover, .nav-link:hover {
                  background: linear-gradient(120deg,#b39aff,#8da6ff,#b7e8ff);
                  background-size: 200% 200%;
                  animation: moveGlow 1.5s ease infinite;
                }
                @keyframes moveGlow {
                  0%{ background-position: 0% 50%; }
                  100%{ background-position: 100% 50%; }
                }

                /* ===== 툴 이름 라벨 스타일 ===== */
                .toolname{
                  display: inline-flex;
                  align-items: center;
                  justify-content: center;
                  gap: 6px;

                  background: rgba(255, 255, 255, 0.88);
                  color: #1a1a1a;
                  font-weight: 600;
                  font-size: 0.92rem;
                  letter-spacing: 0.2px;

                  padding: 8px 18px;
                  border-radius: 999px;
                  border: 1px solid rgba(75, 46, 230, 0.08);
                  box-shadow: 0 2px 6px rgba(75,46,230,0.06);
                  transition: all 0.25s ease;
                  margin: 0;
                  margin-top: 0.5rem;
                }

                /* 라벨 앞 포인트 점 */
                .toolname::before{
                  content: "•";
                  color: #7d6aff;
                  font-size: 1.15rem;
                  line-height: 1;
                  margin-right: 3px;
                }

                /* hover 시 살짝 밝게 */
                .d-flex.flex-column:hover .toolname{
                  background: rgba(255, 255, 255, 0.96);
                  border-color: rgba(75, 46, 230, 0.15);
                  box-shadow: 0 4px 10px rgba(75,46,230,0.12);
                  transform: translateY(-1px);
                }

                /* 8) 검색창 고급 테두리 & 포커스 */
                .page-header-search .input-group {
                  border-radius: 9999px; overflow: hidden;
                  border: 1px solid rgba(161, 139, 255, 0.35);
                  box-shadow:
                    0 2px 14px rgba(0,0,0,0.08),
                    0 0 0 1px rgba(161, 139, 255, 0.20) inset;
                  backdrop-filter: blur(8px);
                }
                .page-header-search .form-control {
                  background: rgba(255,255,255,0.75);
                }
                body[data-theme="dark"] .page-header-search .form-control {
                  background: rgba(20,20,30,0.75); color: #eaeaf4;
                }
                .page-header-search .form-control:focus {
                  box-shadow: 0 0 0 3px rgba(180,159,255,0.25);
                }

                /* 9) 사이드 메뉴 글씨를 오른쪽으로 조금 더 */
                .sidenav .nav-link {
                  padding-left: 1.1rem;
                }
                .sidenav .sidenav-menu-nested .nav-link {
                  padding-left: 1.8rem;
                }


            /* ========== A-VERSE Section Base (Lavender Glass) ========== */
                .az-section {
                  padding: 28px 0 64px;
                  background: linear-gradient(180deg, var(--az-lav-1, #efeaff), rgba(0,0,0,0));
                }

                /* 섹션 타이틀: 중앙정렬 + 밑줄 */
                .az-section .section-title {
                  margin: 0 0 18px;
                  font-weight: 800;
                  font-size: 1.55rem;
                  letter-spacing: .4px;
                  text-align: center;
                  background: linear-gradient(90deg,#a99aff,#c0b5ff,#dcd6ff);
                  -webkit-background-clip: text;
                  -webkit-text-fill-color: transparent;
                  position: relative;
                  display: inline-block;
                }
                .az-section .section-title::after {
                  content: "";
                  display: block;
                  margin: 10px auto 0;
                  width: 180px;
                  height: 3px;
                  border-radius: 999px;
                  background: linear-gradient(90deg,#c9bfff,#bcd0ff);
                  box-shadow: 0 4px 12px rgba(160,140,255,.25);
                }

                /* 그리드 간격(Explore 2열) */
                .az-section .row.gx-explore { --bs-gutter-x: 2rem; --bs-gutter-y: 2rem; }

                /* 라벤더 글래스 카드 */
                .metric-card{
                  border: 0; border-radius: 22px;
                  background: linear-gradient(90deg,#dcd6ff,#c8c1ff);
                  box-shadow: 0 6px 18px rgba(160,140,255,.12);
                  overflow: hidden;
                  transition: transform .18s ease, box-shadow .18s ease;
                }
                .metric-card:hover{ transform: translateY(-2px); box-shadow: 0 10px 28px rgba(160,140,255,.22); }

                /* 카드 헤더: 좌/우 정렬 옵션 */
                .metric-card .card-header{
                  border:0; padding:16px 22px;
                  background: linear-gradient(90deg,#dcd6ff,#c8c1ff);
                  display:flex; align-items:center;
                  color:#4b3d84 !important; font-weight:700; font-size:1.05rem;
                }
                .metric-card .card-header.header-left { justify-content:flex-start; }
                .metric-card .card-header.header-right{ justify-content:flex-end;   }

                .metric-card .card-body{
                  background: linear-gradient(180deg,#ffffff,rgba(255,255,255,.7));
                  padding: 20px 22px 22px;
                }

                /* 카드 내부 링크 파랑 제거 */
                #workspace-zone a, #explore-zone a { color: inherit !important; text-decoration:none; }

                    /* ===== 공통 섹션 배경 & 제목 라인 ===== */
                    .az-section {
                      position: relative;
                      background: linear-gradient(180deg, #f3f5ff 0%, #eef0ff 100%);
                      border-radius: 28px;
                      padding: 32px 22px 72px; /* 하단 여백 넉넉 */
                      box-shadow: 0 12px 36px rgba(40, 30, 120, 0.06) inset;
                      margin-bottom: 40px;
                    }

                    .az-section .section-title {
                      text-align: center;
                      font-weight: 800;
                      letter-spacing: 0.5px;
                      color: #7d6aff;
                      opacity: .95;
                      margin-bottom: 18px;
                    }
                    .az-section .section-title::after {
                      content: "";
                      display: block;
                      width: 140px;
                      height: 3px;
                      margin: 10px auto 0;
                      border-radius: 999px;
                      background: linear-gradient(90deg, #b39aff, #8da6ff, #b7e8ff);
                    }




/*====================================================워크스페이스 가져가세요===============================================================================*/


                    /* ===== Workspace 카드 크기 ↓ (반쯤 줄이기) ===== */
                    #workspace-zone .card {
                      max-width: 900px;  /* 가로 폭 */
                      margin: 0 auto;
                      border-radius: 22px;
                      box-shadow: 0 6px 14px rgba(160, 140, 255, 0.12);
                    }
                    #workspace-zone .card-header { padding: .8rem 1rem; }
                    #workspace-zone .card-body   { padding: 1.0rem 1.25rem; } /* 세로 간격 축소 */

                    /* ===== 워크스페이스 카드 내부 작은 스크롤바 ===== */
                    #workspace-zone .card-body::-webkit-scrollbar {
                      height: 6px; /* 스크롤바 높이 (가로 스크롤) */
                    }
                    #workspace-zone .card-body::-webkit-scrollbar-track {
                      background: rgba(200, 200, 220, 0.1);
                      border-radius: 10px;
                    }
                    #workspace-zone .card-body::-webkit-scrollbar-thumb {
                      background: linear-gradient(90deg, #b39aff, #8da6ff);
                      border-radius: 10px;
                    }
                    #workspace-zone .card-body::-webkit-scrollbar-thumb:hover {
                      background: linear-gradient(90deg, #9c8cff, #7d96ff);
                    }

/*====================================================워크스페이스 가져가세요=============================================================================== */

                    /* ===== Explore 리스트 카드화 + 배지 ===== */
                    .metric-card .card-header {
                      background: linear-gradient(90deg, #d8d0ff, #e6e2ff);
                      border: none;
                      color: #5a4fb8 !important; /* 파란색 방지 */
                      font-weight: 700;
                      border-radius: 18px 18px 0 0;
                    }
                    .header-left  { text-align: left;  padding-left: 18px; }
                    .header-right { text-align: right; padding-right: 18px; }

                    .metric-card .card-body { padding: 14px; }

                    .metric-card .rank-item {
                      display: flex; justify-content: space-between; align-items: center;
                      background: rgba(255, 255, 255, 0.65);
                      border-radius: 12px;
                      padding: 10px 14px; margin-bottom: 10px;
                      box-shadow: 0 2px 8px rgba(160,140,255,0.12);
                      transition: all .2s ease;
                    }
                    .metric-card .rank-item:hover {
                      transform: translateY(-2px);
                      background: rgba(255,255,255,0.85);
                      box-shadow: 0 4px 14px rgba(160,140,255,0.22);
                    }

                    .metric-card .rank-item .title {
                      font-weight: 600; color: #3e3273; font-size: .96rem;
                    }
                    .metric-card .rank-item .badge {
                      font-size: .75rem; border-radius: 999px; padding: 4px 10px;
                      font-weight: 700; color: #fff; letter-spacing: .2px;
                    }
                    .metric-card .rank-item .badge.like     { background: linear-gradient(90deg,#b197ff,#8da6ff); }
                    .metric-card .rank-item .badge.download { background: linear-gradient(90deg,#8eb9ff,#8da6ff); }

                    /* ===== 레이아웃 여백 보정 ===== */
                    #workspace-zone.az-section   { padding-bottom: 72px; }
                    #explore-zone.az-section     { padding-bottom: 120px; } /* 하단 더 여유 */

                    @media (min-width: 992px) {
                      .gx-explore { --bs-gutter-x: 28px; }
                    }

            /* 워크스페이스 카드 로고 전용 스타일 */
                .workspace-logo {
                  width: 100%;
                  height: auto;            /* 비율 자동 유지 */
                  object-fit: contain;     /* 상자 안에 맞게 축소 */
                  display: block;
                  border-radius: 12px;     /* 부드러운 모서리 (원하면 0으로 변경) */
                  background-color: transparent;
                  transition: transform 0.25s ease;
                }

                .workspace-logo:hover {
                  transform: scale(1.05);  /* 살짝 커지게 */
                }

                 /* lumino 링크 스타일: 검은색, 클릭 효과 제거 */
                 .lumino-link {
                     color: #000 !important;
                     text-decoration: none;
                     cursor: default;
                     pointer-events: none;
                 }
                 .lumino-link:hover,
                 .lumino-link:active,
                 .lumino-link:focus {
                     color: #000 !important;
                     text-decoration: none;
                     transform: none !important;
                     animation: none !important;
                     transition: none !important;
                 }

            /* ===== 메인 페이지 세로 스크롤바 스타일 (카테고리 페이지와 동일) ===== */
            /***** Chrome/Edge *****/
                *::-webkit-scrollbar{ height:10px; width:10px; }
                *::-webkit-scrollbar-thumb{
                  background: linear-gradient(90deg, #b39aff, #8da6ff);
                  border-radius:999px; border:2px solid transparent; background-clip: content-box;
                }
                *::-webkit-scrollbar-track{ background: transparent; }
                /***** Firefox *****/
                *{
                  scrollbar-color: #b39aff transparent;
                  scrollbar-width: thin;
                }

        </style>



        <!-- 공통 스크립트 라이브러리 -->
        <th:block th:replace="~{fragments/head :: common-scripts-head}"></th:block>
    </head>

    <!-- 상단 네비게이션이 스크롤해도 고정(fixed) 되게 하는 클래스 -->
    <body class="nav-fixed" data-theme="light">

        <!-- 상단 네비게이션 (Fragment) -->
        <div th:replace="~{fragments/header :: header}"></div>
        <!-- 네비게이션 전체 레이아웃 -->
        <div id="layoutSidenav">
            <!-- 왼쪽 사이드바 (Fragment) -->
            <div th:replace="~{fragments/sidebar :: sidebar}"></div>

            <div id="layoutSidenav_content">

                <main>

                    <!-- 윗쪽 박스 -->
                    <header class="page-header page-header-dark mb-4"
                            style="background: linear-gradient(140deg, #f4efff 0%, #e4d8ff 25%, #d8e4ff 60%, #c9cbff 100%);">
                        <div class="container-xl px-4">

                    <!-- 윗쪽 박스 크기 조절-->
                    <div class="page-header-content pt-4" style="min-height: 10vh; display: flex; flex-direction: column; justify-content: flex-start;">

                        <!-- 로고 박스 -->
                                <div class="row align-items-center justify-content-between">
                                    <div class="d-flex align-items-center justify-content-center" style="min-height: 220px; margin-top: 0.5rem; margin-bottom: 0.5rem;">
                                        <img src="/assets/img/RightServiceLogo.png" alt="Logo" style="max-height: 360px; width: auto;" />
                                    </div>
                                </div>
                        <!-- 검색창 -->
                        <div class="page-header-search"
                             style="min-height: 5vh; display: flex; align-items: center; justify-content: center; margin-top: 1.5rem;">
                            <form id="searchForm" action="/category_all" method="get" style="width: 100%; max-width: 1200px;">
                                <div class="input-group input-group-joined search-bar" style="max-width: 1200px; width: 100%; border-radius: 9999px; overflow: hidden;">
                                    <input class="form-control search-input" type="text" name="keyword" placeholder="Search..." aria-label="Search" autofocus style="border: none;" />
                                    <span class="input-group-text search-icon" style="border: none;"><i data-feather="search"></i></span>
                                </div>
                            </form>
                        </div>
                            </div>
                        </div>
                    </header>




<!-- ====================================================워크스페이스 가져가세요=============================================================================== -->

                    <!-- ========== Workspace Zone (라벤더 배경 + 타이틀 밑줄) ========== -->
                    <section id="workspace-zone" class="az-section">
                        <div class="container-xl px-4">
                            <h2 class="section-title">Workspace Zone</h2>

                            <!-- 기존 AI Tools 카드 그대로 넣되, 불필요한 inline-style 제거 권장 -->
                            <div class="card mt-4">
                                <div class="card-header d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-stack bg-secondary-soft text-secondary me-3"><i data-feather="cpu"></i></div>
                                        <div>
                                            <h5 class="mb-0" id="workspace-title-index" th:text="${workspace != null ? workspace.workspaceName : 'Engineering'}"
                                                contenteditable="false"
                                                style="cursor: text; padding: 4px 8px; border-radius: 4px; min-width: 120px;">Engineering</h5>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-column align-items-end gap-2">
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-sm btn-secondary"
                                                    onclick="createNewWorkspaceModeIndex()">
                                                <i data-feather="plus" style="width: 14px; height: 14px;"></i>
                                                새 워크스페이스
                                            </button>
                                            <button type="button" class="btn btn-sm btn-transparent-dark" id="toggleDeleteModeIndex"
                                                    onclick="toggleDeleteModeIndex()"
                                                    title="도구 삭제">
                                                <i data-feather="trash-2" style="color: #dc3545;"></i>
                                            </button>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <label class="small text-muted me-2" for="workspace-select-inline">Workspace</label>
                                            <select class="form-select form-select-sm" id="workspace-select-inline" style="min-width:160px;" onchange="changeWorkspace(this)">
                                                <option value="">워크스페이스 선택</option>
                                                <option th:each="ws : ${workspaces}"
                                                        th:value="${ws.workspace_id}"
                                                        th:text="${ws.workspace_name}"
                                                        th:selected="${ws.workspace_id == 1}">
                                                    Workspace Name
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body" style="overflow-x: auto; overflow-y: hidden;">
                                    <div class="row g-3 justify-content-start flex-nowrap" id="workspace-tools-container">

                                        <!-- 데이터베이스에서 가져온 도구들을 동적으로 표시 -->
                                        <div class="col-auto tool-item-index" th:each="tool : ${workspace != null ? workspace.tools : {}}"
                                             th:attr="data-tool-id=${tool.toolId}">
                                            <div class="d-flex flex-column align-items-center position-relative">
                                                <a class="card lift lift-sm text-center rounded-4" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px;" href="tool-model-runner.html">
                                                    <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                                        <img th:src="@{/assets/img/logo_img/{name}.png(name=${tool.toolName})}"
                                                             th:alt="${tool.toolName} + ' Logo'"
                                                             class="workspace-logo">
                                                    </div>
                                                </a>
                                                <div class="tool-delete-icon-index" style="position: absolute; top: -8px; right: -8px; width: 28px; height: 28px; border-radius: 50%; background: #dc3545; display: none; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 10;"
                                                     th:attr="onclick='deleteToolFromWorkspaceIndex(' + ${tool.toolId} + ')'">
                                                    <i data-feather="x" style="width: 18px; height: 18px; color: white; stroke-width: 3;"></i>
                                                </div>
                                                <div class="toolname" th:text="${tool.toolName}">Tool Name</div>
                                            </div>
                                        </div>

                                        <!-- Add Tool 버튼 -->
                                        <div class="col-auto">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="card lift lift-sm text-center rounded-4" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px; cursor: pointer;" onclick="event.stopPropagation(); showAddToolModal();">
                                                    <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                                        <i class="mb-2" data-feather="plus"></i>
                                                        <div>Add Tool</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

<!-- ====================================================워크스페이스 가져가세요=============================================================================== -->




                    <!-- ========== Explore Zone (2열: 좌=저장 Top, 우=사용 Top) ========== -->
                    <section id="explore-zone" class="az-section">
                        <div class="container-xl px-4">
                            <h2 class="section-title">Explore Zone</h2>

                            <div class="row gx-explore mt-4">
                                <!-- Left: 직장인이 많이 쓰는 워크스페이스 -->
                                <div class="col-12 col-lg-6">
                                    <div class="metric-card card h-100">
                                        <div class="card-header header-left">직장인이 많이 쓰는 워크스페이스</div>
                                        <div class="card-body">
                                            <div class="rank-item">
                                                <span class="title">ChatGPT</span>
                                                <span class="badge like">❤️ 1,285</span>
                                            </div>
                                            <div class="rank-item">
                                                <span class="title">Gemini</span>
                                                <span class="badge like">❤️ 1,033</span>
                                            </div>
                                            <div class="rank-item">
                                                <span class="title">Claude</span>
                                                <span class="badge like">❤️ 913</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right: 대학생이 많이 쓰는 워크스페이스 -->
                                <div class="col-12 col-lg-6">
                                    <div class="metric-card card h-100">
                                        <div class="card-header header-right">대학생이 많이 쓰는 워크스페이스</div>
                                        <div class="card-body">
                                            <div class="rank-item">
                                                <span class="title">ChatGPT</span>
                                                <span class="badge download">❤️ 3,843</span>
                                            </div>
                                            <div class="rank-item">
                                                <span class="title">Wrtn</span>
                                                <span class="badge download">❤️ 2,730</span>
                                            </div>
                                            <div class="rank-item">
                                                <span class="title">DALL-E</span>
                                                <span class="badge download">❤️ 2,215</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </section>


                </main>
            </div>
        </div>

        <!-- 공통 스크립트 -->
        <th:block th:replace="~{fragments/scripts :: common-scripts}"></th:block>

        <!-- 사이드바 자동 펼치기 -->
        <th:block th:replace="~{fragments/scripts :: sidebar-auto-expand}"></th:block>

        <!-- ✅ 챗봇 버튼 (항상 우측 하단 고정) -->
        <div id="chatbot-button">
            <img src="/assets/img/AI_chatbot.png" alt="Chatbot" />
        </div>

        <!-- ✅ 챗봇 팝업창 -->
        <div id="chatbot-popup">
            <div id="chatbot-header">
                <span>A-VERSE Chatbot</span>
                <button id="chatbot-close">&times;</button>
            </div>
            <div id="chatbot-body">
                <!-- 로컬 개발 환경용 -->
                <iframe src="/chatbot_page.html" title="Chatbot" frameborder="0"></iframe>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
              const chatbotBtn = document.getElementById('chatbot-button');
              const chatbotPopup = document.getElementById('chatbot-popup');
              const chatbotClose = document.getElementById('chatbot-close');

              // 챗봇 버튼 클릭 시 토글
              chatbotBtn.addEventListener('click', function () {
                if (chatbotPopup.style.display === 'block') {
                  chatbotPopup.style.display = 'none';
                } else {
                  chatbotPopup.style.display = 'block';
                }
              });

              // 닫기 버튼 클릭 시 닫기
              chatbotClose.addEventListener('click', function () {
                chatbotPopup.style.display = 'none';
              });
            });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
              const form  = document.getElementById('searchForm');
              const input = form.querySelector('.search-input');

              form.addEventListener('submit', (e) => {
                e.preventDefault(); // 기본 submit 막기

                const q = (input.value || '').trim();
                if (!q) {
                  input.focus();
                  return;
                }

                // 반짝이는 피드백 추가
                input.classList.remove('enter-pulse');
                void input.offsetWidth;
                input.classList.add('enter-pulse');

                // 모든 검색을 category_all로 이동
                setTimeout(() => {
                  window.location.href = `http://averse.world/category_all?keyword=${encodeURIComponent(q)}`;
                }, 200);
              });
            });

            // 새 워크스페이스 생성 모드 플래그 (index용)
            let isNewWorkspaceModeIndex = false;
            let newWorkspaceIdIndex = null;

            // 새 워크스페이스 생성 모드 (index용)
            function createNewWorkspaceModeIndex() {
                isNewWorkspaceModeIndex = true;
                newWorkspaceIdIndex = null;

                // 제목을 편집 가능하게 만들고 기본 텍스트 설정
                const titleElement = document.getElementById('workspace-title-index');
                if (titleElement) {
                    titleElement.textContent = '새 워크스페이스';
                    titleElement.contentEditable = 'true';
                    titleElement.style.border = '1px solid #dee2e6';
                    titleElement.focus();

                    // 텍스트 전체 선택
                    const range = document.createRange();
                    range.selectNodeContents(titleElement);
                    const sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);
                }

                // 워크스페이스 선택 초기화
                const selectElement = document.getElementById('workspace-select-inline');
                if (selectElement) {
                    selectElement.value = '';
                }

                // 도구 목록 초기화 - Add Tool만 표시
                const toolsContainer = document.getElementById('workspace-tools-container');
                if (toolsContainer) {
                    toolsContainer.innerHTML = `
                        <div class="col-auto">
                            <div class="d-flex flex-column align-items-center">
                                <div class="card lift lift-sm text-center rounded-4" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px; cursor: pointer;" onclick="event.stopPropagation(); showAddToolModal();">
                                    <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                        <i class="mb-2" data-feather="plus"></i>
                                        <div>Add Tool</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // Feather icons 다시 초기화
                    if (typeof feather !== 'undefined') {
                        feather.replace();
                    }
                }
            }

            // 워크스페이스 이름 저장 (index용) - 편집 종료 시 포커스 해제만
            function saveWorkspaceNameIndex(element) {
                if (!isNewWorkspaceModeIndex) {
                    return; // 새 워크스페이스 모드가 아니면 아무것도 하지 않음
                }

                // 편집 모드 해제만 하고, 실제 저장은 도구 추가할 때 함
                element.contentEditable = 'false';
                element.style.border = 'none';
            }

            // 워크스페이스 변경 함수
            function changeWorkspace(selectElement) {
                const workspaceId = selectElement.value;
                if (!workspaceId) {
                    return;
                }

                // 새 워크스페이스 모드 비활성화
                isNewWorkspaceModeIndex = false;
                newWorkspaceIdIndex = null;

                // 제목 편집 비활성화
                const titleElement = document.getElementById('workspace-title-index');
                if (titleElement) {
                    titleElement.contentEditable = 'false';
                    titleElement.style.border = 'none';
                }

                console.log('워크스페이스 변경:', workspaceId);

                // AJAX로 워크스페이스 정보 가져오기
                fetch('/api/workspace/' + workspaceId)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('API 요청 실패: ' + response.status);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('받은 데이터:', data);

                        // 제목 업데이트
                        const titleElement = document.querySelector('#workspace-zone .card-header h5');
                        if (titleElement) {
                            titleElement.textContent = data.workspaceName;
                            console.log('제목 업데이트 완료:', data.workspaceName);
                        }

                        // 도구 목록 업데이트
                        const toolsContainer = document.getElementById('workspace-tools-container');
                        console.log('도구 컨테이너:', toolsContainer);

                        if (toolsContainer) {
                            toolsContainer.innerHTML = '';
                            console.log('도구 개수:', data.tools ? data.tools.length : 0);

                            if (data.tools && data.tools.length > 0) {
                                data.tools.forEach(tool => {
                                    console.log('도구 추가:', tool.toolName);
                                    const toolHtml = `
                                        <div class="col-auto tool-item-index" data-tool-id="${tool.toolId}">
                                            <div class="d-flex flex-column align-items-center position-relative">
                                                <a class="card lift lift-sm text-center rounded-4" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px;" href="tool-model-runner.html">
                                                    <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                                        <img src="/assets/img/logo_img/${tool.toolName}.png" alt="${tool.toolName} Logo" class="workspace-logo">
                                                    </div>
                                                </a>
                                                <div class="tool-delete-icon-index" style="position: absolute; top: -8px; right: -8px; width: 28px; height: 28px; border-radius: 50%; background: #dc3545; display: none; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 10;"
                                                     onclick="deleteToolFromWorkspaceIndex(${tool.toolId})">
                                                    <i data-feather="x" style="width: 18px; height: 18px; color: white; stroke-width: 3;"></i>
                                                </div>
                                                <div class="toolname">${tool.toolName}</div>
                                            </div>
                                        </div>
                                    `;
                                    toolsContainer.innerHTML += toolHtml;
                                });
                            } else {
                                toolsContainer.innerHTML = '<div class="col-auto"><p class="text-muted">도구가 없습니다.</p></div>';
                            }

                            // Add Tool 버튼 추가
                            toolsContainer.innerHTML += `
                                <div class="col-auto">
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="card lift lift-sm text-center rounded-4" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px; cursor: pointer;" onclick="event.stopPropagation(); showAddToolModal();">
                                            <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                                <i class="mb-2" data-feather="plus"></i>
                                                <div>Add Tool</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;

                            // Feather icons 다시 초기화
                            if (typeof feather !== 'undefined') {
                                feather.replace();
                            }

                            // 삭제 모드가 활성화되어 있으면 삭제 아이콘 표시
                            if (isDeleteModeActiveIndex) {
                                const deleteIcons = document.querySelectorAll('.tool-delete-icon-index');
                                deleteIcons.forEach(icon => {
                                    icon.style.display = 'flex';
                                });
                            }

                            console.log('도구 목록 업데이트 완료');
                        } else {
                            console.error('도구 컨테이너를 찾을 수 없습니다');
                        }
                    })
                    .catch(error => {
                        console.error('워크스페이스 로드 실패:', error);
                        alert('워크스페이스를 불러오는데 실패했습니다: ' + error.message);
                    });
            }

            // 삭제 모드 토글 (index용)
            let isDeleteModeActiveIndex = false;

            function toggleDeleteModeIndex() {
                isDeleteModeActiveIndex = !isDeleteModeActiveIndex;
                const deleteIcons = document.querySelectorAll('.tool-delete-icon-index');
                const toggleBtn = document.getElementById('toggleDeleteModeIndex');

                if (isDeleteModeActiveIndex) {
                    deleteIcons.forEach(icon => {
                        icon.style.display = 'flex';
                    });
                    toggleBtn.innerHTML = '<i data-feather="x" style="color: #6c757d;"></i>';
                    toggleBtn.title = '취소';
                } else {
                    deleteIcons.forEach(icon => {
                        icon.style.display = 'none';
                    });
                    toggleBtn.innerHTML = '<i data-feather="trash-2" style="color: #dc3545;"></i>';
                    toggleBtn.title = '도구 삭제';
                }

                // Feather icons 다시 초기화
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
            }

            // 워크스페이스에서 도구 삭제 (index용)
            function deleteToolFromWorkspaceIndex(toolId) {
                const workspaceId = document.getElementById('workspace-select-inline')?.value;

                if (!workspaceId) {
                    alert('워크스페이스를 선택해주세요.');
                    return;
                }

                if (!confirm('이 도구를 삭제하시겠습니까?')) {
                    return;
                }

                fetch(`/api/workspace/${workspaceId}/tool/${toolId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('삭제 실패');
                    }
                    return response.text();
                })
                .then(data => {
                    alert('도구가 삭제되었습니다.');
                    // 워크스페이스 새로고침
                    const selectElement = document.getElementById('workspace-select-inline');
                    if (selectElement) {
                        changeWorkspace(selectElement);
                    }
                    // 삭제 모드 해제
                    isDeleteModeActiveIndex = true;
                    toggleDeleteModeIndex();
                })
                .catch(error => {
                    console.error('도구 삭제 실패:', error);
                    alert('도구 삭제에 실패했습니다.');
                });
            }
        </script>

        <!-- Add Tool Modal -->
        <div class="modal fade" id="addToolModal" tabindex="-1" aria-labelledby="addToolModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" style="max-width: 600px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addToolModalLabel">도구 추가</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <div id="toolsContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // 카테고리 이름 매핑
            const categoryNames = {
                1: '글',
                2: '그림',
                3: '음악/음성',
                4: '코딩/개발',
                5: '영상',
                6: '검색',
                7: '교육/학습'
            };

            // Add Tool 모달 열기
            function showAddToolModal() {
                console.log('=== showAddToolModal 시작 (index) ===');
                console.log('isNewWorkspaceModeIndex:', isNewWorkspaceModeIndex);

                const modalElement = document.getElementById('addToolModal');
                console.log('모달 요소:', modalElement);

                if (!modalElement) {
                    console.error('모달 요소를 찾을 수 없음!');
                    return;
                }

                try {
                    const modal = new bootstrap.Modal(modalElement);
                    console.log('모달 생성 완료');
                    modal.show();
                    console.log('모달 show 호출 완료');
                    loadTools();
                    console.log('도구 목록 로딩 시작');
                } catch (error) {
                    console.error('모달 열기 실패:', error);
                }
            }

            // 도구 목록 로드
            function loadTools() {
                fetch('/api/tools/all')
                    .then(response => response.json())
                    .then(tools => {
                        const container = document.getElementById('toolsContainer');
                        container.innerHTML = '';

                        // 카테고리별로 그룹화
                        const toolsByCategory = {};
                        tools.forEach(tool => {
                            const categoryId = tool.categoryId || 0;
                            if (!toolsByCategory[categoryId]) {
                                toolsByCategory[categoryId] = [];
                            }
                            toolsByCategory[categoryId].push(tool);
                        });

                        // 카테고리별로 표시
                        Object.keys(toolsByCategory).sort().forEach(categoryId => {
                            const categoryTools = toolsByCategory[categoryId];
                            const categoryName = categoryNames[categoryId] || '기타';

                            // 카테고리 헤더
                            const categoryHeader = document.createElement('div');
                            categoryHeader.className = 'mb-3 mt-4 d-flex align-items-center';
                            categoryHeader.innerHTML = `
                                <h6 class="fw-bold text-secondary mb-0 me-3">${categoryName}</h6>
                                <div style="flex: 1; height: 2px; background: linear-gradient(90deg, #9c8cff, #a7b7ff); border-radius: 1px;"></div>
                            `;
                            container.appendChild(categoryHeader);

                            // 도구 그리드 (가로 3줄)
                            const toolsGrid = document.createElement('div');
                            toolsGrid.className = 'row g-2 mb-4';
                            
                            categoryTools.forEach(tool => {
                                const toolCol = document.createElement('div');
                                toolCol.className = 'col-4';

                                const card = document.createElement('div');
                                card.className = 'card text-center';
                                card.style.cssText = 'cursor: pointer; border: 1px solid #dee2e6; border-radius: 0.75rem; padding: 0.5rem; height: 100%;';

                                // addEventListener를 사용하여 이벤트 핸들러 추가
                                card.addEventListener('click', function(e) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    selectTool(tool.toolId, tool.toolName);
                                });

                                const cardBody = document.createElement('div');
                                cardBody.className = 'card-body p-2';

                                const img = document.createElement('img');
                                img.src = `/assets/img/logo_img/${encodeURIComponent(tool.toolName)}.png`;
                                img.alt = `${tool.toolName} Logo`;
                                img.className = 'img-fluid mb-2';
                                img.style.cssText = 'max-width: 60px; max-height: 60px; object-fit: contain;';
                                img.onerror = function() { this.src = '/assets/img/logo_img/default.png'; };

                                const toolNameDiv = document.createElement('div');
                                toolNameDiv.className = 'toolname';
                                toolNameDiv.style.cssText = 'font-size: 0.75rem; font-weight: 500; color: #333;';
                                toolNameDiv.textContent = tool.toolName;

                                cardBody.appendChild(img);
                                cardBody.appendChild(toolNameDiv);
                                card.appendChild(cardBody);
                                toolCol.appendChild(card);
                                toolsGrid.appendChild(toolCol);
                            });

                            container.appendChild(toolsGrid);
                        });
                    })
                    .catch(error => {
                        console.error('도구 로드 실패:', error);
                        document.getElementById('toolsContainer').innerHTML = '<p class="text-danger">도구를 불러오는데 실패했습니다.</p>';
                    });
            }

            // 도구 선택
            function selectTool(toolId, toolName) {
                // 새 워크스페이스 모드인 경우
                if (isNewWorkspaceModeIndex) {
                    const titleElement = document.getElementById('workspace-title-index');
                    let workspaceName = titleElement ? titleElement.textContent.trim() : '';

                    // 워크스페이스가 아직 생성되지 않았으면 생성
                    if (!newWorkspaceIdIndex) {
                        // 이름 확인
                        if (!workspaceName || workspaceName === '새 워크스페이스' || workspaceName === 'Workspace') {
                            workspaceName = prompt('워크스페이스 이름을 입력해주세요:', '');
                            if (!workspaceName || !workspaceName.trim()) {
                                return;
                            }
                            workspaceName = workspaceName.trim();
                            if (titleElement) {
                                titleElement.textContent = workspaceName;
                                titleElement.contentEditable = 'false';
                                titleElement.style.border = 'none';
                            }
                        }

                        // 워크스페이스 생성
                        fetch('/api/workspace', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ workspaceName: workspaceName, userId: 1 })
                        })
                        .then(response => response.json())
                        .then(workspace => {
                            // workspace_id 또는 workspaceId 둘 다 체크
                            newWorkspaceIdIndex = workspace.workspace_id || workspace.workspaceId;

                            // 워크스페이스 선택 드롭다운 업데이트
                            const selectElement = document.getElementById('workspace-select-inline');
                            if (selectElement) {
                                const option = document.createElement('option');
                                option.value = newWorkspaceIdIndex;
                                option.text = workspaceName;
                                option.selected = true;
                                selectElement.appendChild(option);
                            }

                            // 도구 추가
                            addToolToWorkspaceIndex(toolId, toolName);
                        })
                        .catch(error => {
                            console.error('에러:', error);
                            alert('워크스페이스 생성 실패');
                        });
                    } else {
                        // 이미 생성된 워크스페이스에 도구 추가
                        addToolToWorkspaceIndex(toolId, toolName);
                    }
                    return;
                }

                // 기존 워크스페이스에 도구 추가
                const workspaceId = document.getElementById('workspace-select-inline')?.value;

                if (!workspaceId) {
                    alert('워크스페이스를 먼저 선택해주세요.');
                    return;
                }

                fetch(`/api/workspace/${workspaceId}/add-tool/${toolId}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('서버 응답 오류: ' + response.status);
                    }
                    return response.json();
                })
                .then(() => {
                    alert(`${toolName}이(가) 추가되었습니다.`);
                    bootstrap.Modal.getInstance(document.getElementById('addToolModal')).hide();
                    changeWorkspace(document.getElementById('workspace-select-inline'));
                })
                .catch(error => {
                    console.error('에러:', error);
                    alert('실패했습니다.');
                });
            }

            // 현재 워크스페이스에 도구 추가 (새 워크스페이스 모드용 - index)
            function addToolToWorkspaceIndex(toolId, toolName) {
                fetch(`/api/workspace/${newWorkspaceIdIndex}/add-tool/${toolId}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('서버 응답 오류: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    alert(`${toolName}이(가) 추가되었습니다.`);

                    // 도구 목록에 추가
                    const toolsContainer = document.querySelector('#workspace-zone .row.g-3');
                    if (toolsContainer) {
                        const addToolBtn = toolsContainer.querySelector('.col-auto:last-child');

                        const newToolHtml = `
                            <div class="col-auto tool-item" data-tool-id="${toolId}">
                                <div class="d-flex flex-column align-items-center position-relative">
                                    <div class="card lift lift-sm text-center rounded-4" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px;">
                                        <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                            <img src="/assets/img/logo_img/${toolName}.png" alt="${toolName} Logo" class="workspace-logo">
                                        </div>
                                    </div>
                                    <div class="tool-delete-icon" style="position: absolute; top: -8px; right: -8px; width: 28px; height: 28px; border-radius: 50%; background: #dc3545; display: none; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 10;"
                                         onclick="deleteToolFromWorkspace(${toolId})">
                                        <i data-feather="x" style="width: 18px; height: 18px; color: white; stroke-width: 3;"></i>
                                    </div>
                                    <div class="toolname">${toolName}</div>
                                </div>
                            </div>
                        `;

                        if (addToolBtn) {
                            addToolBtn.insertAdjacentHTML('beforebegin', newToolHtml);
                        }

                        if (typeof feather !== 'undefined') {
                            feather.replace();
                        }
                    }

                    // 모달 닫기
                    bootstrap.Modal.getInstance(document.getElementById('addToolModal')).hide();
                })
                .catch(error => {
                    console.error('에러:', error);
                    alert('도구 추가 실패');
                });
            }
        </script>

    </body>
</html>
