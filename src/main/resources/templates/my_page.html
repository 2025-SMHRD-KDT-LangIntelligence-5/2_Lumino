<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Edit User - SB Admin Pro</title>
        <link href="/css/styles.css" rel="stylesheet" />
        <link href="/css/mypage.css" rel="stylesheet" />
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.png" />
        <script data-search-pseudo-elements defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js" crossorigin="anonymous"></script>

        <style>

            /* === A-VERSE 감성 디테일 (라이트/다크 공통으로 덮어쓰기) === */

                 /* 1) 네비게이션/사이드바 글래스 질감 */
                 .topnav,
                 .sidenav {
                   backdrop-filter: blur(12px);
                   -webkit-backdrop-filter: blur(12px);
                 }
                 body[data-theme="light"] .topnav,
                 body[data-theme="light"] .sidenav {
                   background: rgba(255,255,255,0.60);
                   border: 1px solid rgba(180,180,255,0.20);
                   box-shadow: 0 6px 18px rgba(160,140,255,0.10);
                 }


                 /* 3) 카드 부유감 */
                 .card.lift:hover {
                   transform: translateY(-4px);
                   box-shadow: 0 10px 28px rgba(160,140,255,0.22);
                 }

                 /* 6) 페이지 헤더(로고 영역) 글로시 오버레이 */
                 .page-header {
                   position: relative; overflow: hidden;
                 }
                 .page-header::after{
                   content:"";
                   position:absolute; inset:0;
                   background:
                     radial-gradient(600px 180px at 10% -10%, rgba(179,154,255,0.15), transparent 60%),
                     radial-gradient(500px 160px at 85% -10%, rgba(141,166,255,0.12), transparent 60%);
                   pointer-events: none;
                 }

                 /* 7) 버튼/링크 호버 오로라 흐름 */
                 .btn:hover, .nav-link:hover {
                   background: linear-gradient(120deg,#b39aff,#8da6ff,#b7e8ff);
                   background-size: 200% 200%;
                   animation: moveGlow 1.5s ease infinite;
                 }
                 @keyframes moveGlow {
                   0%{ background-position: 0% 50%; }
                   100%{ background-position: 100% 50%; }
                 }

                 /* 8) 검색창 고급 테두리 & 포커스 */
                 .page-header-search .input-group {
                   border-radius: 9999px; overflow: hidden;
                   border: 1px solid rgba(161, 139, 255, 0.35);
                   box-shadow:
                     0 2px 14px rgba(0,0,0,0.08),
                     0 0 0 1px rgba(161, 139, 255, 0.20) inset;
                   backdrop-filter: blur(8px);
                 }
                 .page-header-search .form-control {
                   background: #ffffff;
                 }
                 body[data-theme="dark"] .page-header-search .form-control {
                   background: rgba(20,20,30,0.75); color: #eaeaf4;
                 }
                 .page-header-search .form-control:focus {
                   box-shadow: 0 0 0 3px rgba(180,159,255,0.25);
                 }

                 /* 9) 사이드 메뉴 글씨를 오른쪽으로 조금 더 */
                 .sidenav .nav-link {
                   padding-left: 1.1rem;
                 }
                 .sidenav .sidenav-menu-nested .nav-link {
                   padding-left: 1.8rem;
                 }

            /* 모드 이미지 버튼 (이미지만 보이게) */
            .mode-btn{
              all: unset;                  /* 기본 버튼 스타일 제거 */
              display: flex !important;
              align-items: center;
              justify-content: center;
              width: 6rem;              /* 크기 조정: 더 키우려면 값만 늘리세요 */
              height: 4.25rem;
              cursor: pointer;
              margin: 0 auto;              /* 가운데 정렬 */
            }
            .mode-btn img{
              width: 100%;
              height: 100%;
              display: block;
              border-radius: 18px;         /* 이미지 모서리 살짝 라운드 (원한다면 0으로) */
              pointer-events: none;        /* 클릭 판정은 버튼이 받도록 */
            }

            /* 호버 시 살짝 글로우 */
            .mode-btn:hover{
              filter: drop-shadow(0 0 12px rgba(161,139,255,.55));
              transform: translateZ(0);
            }

            /* 두 섹션 공통 적용: id가 workspace-zone로 시작하거나 .az-section 클래스인 섹션 모두 */
            section[id^="workspace-zone"] .card,
            .az-section .card{
              max-width: 900px;       /* 가로 폭 */
              margin: 0 auto;
              border-radius: 22px;
              box-shadow: 0 6px 14px rgba(160,140,255,.12);
            }
            section[id^="workspace-zone"] .card-header,
            .az-section .card-header{
              padding: .8rem 1rem;
            }
            section[id^="workspace-zone"] .card-body,
            .az-section .card-body{
              padding: 1.0rem 1.25rem; /* 세로 간격 */
            }

             /* 워크스페이스 카드 로고 전용 스타일 */
                .workspace-logo {
                  width: 100%;
                  height: auto;            /* 비율 자동 유지 */
                  object-fit: contain;     /* 상자 안에 맞게 축소 */
                  display: block;
                  border-radius: 12px;     /* 부드러운 모서리 (원하면 0으로 변경) */
                  background-color: transparent;
                  transition: transform 0.25s ease;
                }

                .workspace-logo:hover {
                  transform: scale(1.05);  /* 살짝 커지게 */
                }

:root{
                  --lav-1:#ede9ff; --lav-2:#e6ddff; --lav-3:#dcd6ff;
                  --ink-1:#26324b; --ink-2:#4b5675; --ink-3:#7d84a0;
                  --brand:#9c8cff; --accent:#a7b7ff;
                  --card-r:18px; --tile-r:18px; --shadow:0 8px 24px rgba(30,16,80,.08);
                }

                /* 한글 가독 폰트(시스템+나눔스퀘어/프리텐다드 명시) */
                body{ font-family: Pretendard, "Noto Sans KR", "Apple SD Gothic Neo", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
                h1,h2,h3,h4,h5{ color:var(--ink-1); letter-spacing:.1px; }
                .small, .text-muted{ color:var(--ink-3)!important; }


            /* ==============================
               Elegant Universal Body Background
               ============================== */
            html, body {
              height: 100%;
              margin: 0;
              padding: 0;
              background-color: #f9f9ff;
              background-image:
                /* subtle inner glow (top-left) */
                radial-gradient(1200px 480px at 8% -10%, rgba(173,153,255,.12), transparent 60%),
                /* soft diagonal lavender flow */
                linear-gradient(135deg, #fafaff 0%, #f3f5ff 50%, #ecefff 100%),
                /* gentle vignette edges */
                radial-gradient(1200px 600px at 50% 120%, rgba(170,160,255,.08), transparent 70%);
              background-attachment: fixed;
              background-repeat: no-repeat;
              background-size: cover;
              color: #242a39;
              transition: background 0.6s ease, color 0.4s ease;
            }

            /***** Chrome/Edge *****/
                *::-webkit-scrollbar{ height:10px; width:10px; }
                *::-webkit-scrollbar-thumb{
                  background: linear-gradient(var(--brand), var(--accent));
                  border-radius:999px; border:2px solid transparent; background-clip: content-box;
                }
                *::-webkit-scrollbar-track{ background: transparent; }
                /***** Firefox *****/
                *{
                  scrollbar-color: color-mix(in oklab, var(--brand) 55%, #cfd6ff) transparent;
                  scrollbar-width: thin;
                }

            /* 워크스페이스 헤더 액션 버튼 */
                .ws-edit-btn i, .ws-delete-btn i { width: 1rem; height: 1rem; }
                .btn-transparent-dark { background: transparent; border: none; color: #555a66; }
                .btn-transparent-danger { background: transparent; border: none; color: #e04343; }

                .ws-edit-btn:hover { color: #7c6cff; }
                .ws-delete-btn:hover { color: #ff5a5a; }

                 /* lumino 링크 스타일: 검은색, 클릭 효과 제거 */
                 .lumino-link {
                     color: #000 !important;
                     text-decoration: none;
                     cursor: default;
                     pointer-events: none;
                 }
                 .lumino-link:hover,
                 .lumino-link:active,
                 .lumino-link:focus {
                     color: #000 !important;
                     text-decoration: none;
                     transform: none !important;
                     animation: none !important;
                     transition: none !important;
                 }

                /* ===== 라벨(툴 이름) ===== */
                .toolname{
                  display: inline-flex;
                  align-items: center;
                  justify-content: center;
                  gap: 6px;

                  background: rgba(255, 255, 255, 0.88);
                  color: #1a1a1a;
                  font-weight: 600;
                  font-size: 0.92rem;
                  letter-spacing: 0.2px;

                  padding: 8px 18px;
                  border-radius: 999px;
                  border: 1px solid rgba(75, 46, 230, 0.08);
                  box-shadow: 0 2px 6px rgba(75,46,230,0.06);
                  transition: all 0.25s ease;
                  margin: 0;
                  margin-top: 0.5rem; /* 상단 마진 추가 */
                }

                /* 라벨 앞 포인트 점 */
                .toolname::before{
                  content: "•";
                  color: #7d6aff;
                  font-size: 1.15rem;
                  line-height: 1;
                  margin-right: 3px;
                }

                /* hover 시 살짝만 밝게 */
                #workspace-zone-1 .card:hover .toolname,
                #workspace-zone-2 .card:hover .toolname {
                  background: rgba(255, 255, 255, 0.96);
                  border-color: rgba(75, 46, 230, 0.15);
                  box-shadow: 0 4px 10px rgba(75,46,230,0.12);
                  transform: translateY(-1px);
                }

        </style>

    </head>
    <body class="nav-fixed" data-theme="light">
                <nav class="topnav navbar navbar-expand shadow justify-content-between justify-content-sm-start"
             style="background-color: #f4efff;" id="sidenavAccordion">

            <!-- 사이드바 토글 버튼 ☰(메뉴)-->
            <button class="btn btn-icon btn-transparent-dark order-1 order-lg-0 me-2 ms-lg-2 me-lg-0" id="sidebarToggle">
                <i data-feather="menu"></i>
            </button>

            <!-- 네비게이션 상단 좌측 로고 -->
            <a class="navbar-brand pe-3 ps-4 ps-lg-2" href="index"
               style="background: linear-gradient(120deg, #b39aff 0%, #8da6ff 50%, #b7e8ff 100%);
                      -webkit-background-clip: text;
                      -webkit-text-fill-color: transparent;
                      font-weight: 700;
                      letter-spacing: 1px;">A-VERSE</a>

            <!-- 네비게이션(메뉴 항목) 코드가 시작-->
            <ul class="navbar-nav align-items-center ms-auto">

                <!-- 문서 드롭다운 메뉴
                        nav-item → 네비게이션 항목
                        dropdown → 클릭 시 메뉴가 펼쳐지는 드롭다운 형태
                        no-caret → 기본 ▼ 화살표 숨김.
                        d-none d-md-block → 화면 크기가 md(768px) 이상일 때만 표시됨 / 모바일에서는 안 보임
                        me-3 → 오른쪽 여백 추가-->
                <li class="nav-item dropdown no-caret d-none d-md-block me-3">

                    <!-- 드롭다운을 여는 클릭 가능한 링크(버튼)
                            nav-link → 네비게이션 링크 스타일
                            dropdown-toggle → Bootstrap의 "클릭 시 메뉴 열기" 기능을 활성화
                            id="navbarDropdownDocs" → 아래쪽 <div class="dropdown-menu">와 연결할 식별자
                            href="javascript:void(0);" → 클릭해도 페이지 이동하지 않게 함
                            role="button" → 접근성용
                            data-bs-toggle="dropdown" → Bootstrap의 드롭다운 동작을 지정
                            aria-haspopup="true" → "이 버튼이 메뉴를 연다"는 의미
                            aria-expanded="false" → 처음엔 닫혀 있다는 의미-->
                    <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="javascript:void(0);"
                       role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    </a>

                    <!-- 드롭다운을 여는 클릭 가능한 링크(버튼)
                            dropdown-menu → 기본 드롭다운 스타일
                            dropdown-menu-end → 메뉴를 오른쪽 정렬
                            py-0 → 위아래 패딩 제거
                            me-sm-n15 me-lg-0 → 작은 화면에선 오른쪽 여백 조정(-15px)
                            o-hidden → overflow 숨김
                            animated--fade-in-up → 부드럽게 위로 뜨는 애니메이션
                            aria-labelledby="navbarDropdownDocs" → 위의 트리거 버튼(id와 연결)과 연동-->
                    <div class="dropdown-menu dropdown-menu-end py-0 me-sm-n15 me-lg-0 o-hidden animated--fade-in-up" aria-labelledby="navbarDropdownDocs"></div>
                </li>



                <li class="nav-item d-flex align-items-center me-3">
                    <a class="nav-link small fw-semibold lumino-link" style="font-size: 0.85rem; padding: 0; color: #000;">
                        lumino
                    </a>
<!--                    <span class="text-muted mx-1" style="font-size: 0.8rem;">|</span>-->
<!--                    <a href="http://localhost:8087/join_page" class="nav-link small fw-semibold text-muted" style="font-size: 0.85rem; padding: 0;">-->
<!--                        Sign Up-->
<!--                    </a>-->
                </li>



                <!-- 상단 좌측 유저 정보 드롭다운 메뉴 -->
                <li class="nav-item dropdown no-caret dropdown-user me-3 me-lg-4">

                    <!-- btn btn-icon btn-transparent-dark → 투명한 배경의 아이콘형 버튼
                           dropdown-toggle → 클릭하면 드롭다운 메뉴 열림
                           id="navbarDropdownUserImage" → 아래쪽 메뉴(aria-labelledby)와 연결
                           href="javascript:void(0);" → 클릭해도 페이지 이동 X
                           role="button" → 접근성 표시
                           <img class="img-fluid" src="..."> → 사용자 프로필 이미지-->
                    <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="navbarDropdownUserImage" href="javascript:void(0);"
                       role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img class="img-fluid"
                                                                                                               src="assets/img/illustrations/profiles/luminosang.png" /></a>
                    <!--열리는 메뉴 상자-->
                    <div class="dropdown-menu dropdown-menu-end border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownUserImage">

                        <!--유저 클릭시 나오는 상자 내용 첫번째 블럭-->
                        <h6 class="dropdown-header d-flex align-items-center">
                            <img class="dropdown-user-img" src="/assets/img/illustrations/profiles/luminosang.png" />
                            <div class="dropdown-user-details">
                                <div class="dropdown-user-details-name">lumino</div>
                                <div class="dropdown-user-details-email">lumino@gmail.com</div>
                            </div>
                        </h6>

                        <!--회색 구분선-->
                        <div class="dropdown-divider"></div>

                        <!--MY_page-->
                        <a class="dropdown-item" href="http://localhost:8087/my_page">
                            <div class="dropdown-item-icon"><i data-feather="settings"></i></div>
                            MY_page
                        </a>

                        <!--log-out-->
                        <a class="dropdown-item" href="#!">
                            <div class="dropdown-item-icon"><i data-feather="log-out"></i></div>
                            Logout
                        </a>
                    </div>
                </li>
            </ul>




        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sidenav shadow-right sidenav-light">
                    <!-- 사이드바 안에서 메뉴 항목 전체 -->
                    <div class="sidenav-menu">
                        <!--왼쪽 사이드 메뉴에서 대분류 메뉴를 클릭하면 하위 메뉴가 열리고 닫히는 구조-->
                        <div class="nav accordion" id="accordionSidenav">

                            <!-- 사이드바의 카테고리 섹션-->
                            <div class="sidenav-menu-heading">AI 추천</div>
                            <!-- 카테고리 메뉴(아코리언 구조=>하위 메뉴가 접혔다 펼쳐지는 구조)-->
                            <a class="nav-link collapsed"
                               href="javascript:void(0);"
                               data-bs-toggle="collapse"
                               data-bs-target="#collapseDashboards"
                               aria-expanded="false"
                               aria-controls="collapseDashboards">
                                <!--***링크 연결 확인-->
                                <div class="nav-link-icon"><i data-feather="grid"></i></div>
                                카테고리
                                <div class="sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                            </a>
                            <div class="collapse" id="collapseDashboards" data-bs-parent="#accordionSidenav">
                                <nav class="sidenav-menu-nested nav accordion" id="accordionSidenavPages">
                                    <a class="nav-link" href="http://localhost:8087/category_all">전체</a>
                                    <a class="nav-link" href="http://localhost:8087/category_text">글</a>
                                    <a class="nav-link" href="http://localhost:8087/category_image">그림</a>
                                    <a class="nav-link" href="http://localhost:8087/category_audio">음악/음성</a>
                                    <a class="nav-link" href="http://localhost:8087/category_coding">코딩 및 개발</a>
                                    <a class="nav-link" href="http://localhost:8087/category_video">영상</a>
                                    <a class="nav-link" href="http://localhost:8087/category_search">검색</a>
                                    <a class="nav-link" href="http://localhost:8087/category_education">교육, 학습</a>
                                </nav>
                            </div>

                            <!-- 사이드바의 커뮤니티 섹션-->
                            <div class="sidenav-menu-heading">Social</div>
                            <a class="nav-link" href="http://localhost:8087/community_page">
                                <div class="nav-link-icon"><i data-feather="globe"></i></div>
                                커뮤니티
                            </a>

                            <!-- 사이드바의 설정 섹션-->
                            <div class="sidenav-menu-heading">Setting</div>
                            <!-- 설정섹션-->
                            <a class="nav-link collapsed" href="javascript:void(0);" data-bs-toggle="collapse" data-bs-target="#collapseUtilities" aria-expanded="false" aria-controls="collapseUtilities">
                                <div class="nav-link-icon"><i data-feather="tool"></i></div>
                                설정
                                <div class="sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                            </a>
                            <div class="collapse" id="collapseUtilities" data-bs-parent="#accordionSidenav">
                                <nav class="sidenav-menu-nested nav">
                                    <a class="nav-link" href="http://localhost:8087/my_page">마이페이지</a>
                                </nav>
                            </div>
                        </div>
                    </div>

                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <header class="page-header page-header-compact page-header-light border-bottom bg-white" style="margin-bottom: 2.5rem;">
                        <div class="container-xl px-4">
                            <div class="page-header-content">
                                <div class="row align-items-center justify-content-between pt-3">
                                    <div class="col-auto mb-3">
                                        <h1 class="page-header-title">
                                            <div class="page-header-icon"><i data-feather="user"></i></div>
                                            회원정보 수정
                                        </h1>
                                    </div>
                                    <div class="col-12 col-xl-auto mb-3">
                                        <a class="btn btn-sm btn-light text-secondary" href="http://localhost:8087/index">
                                            <i class="me-1" data-feather="arrow-left"></i>
                                            메인화면으로 돌아가기
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>
                    <!-- Main page content-->
                    <div class="container-xl px-4" style="margin-top: 2.5rem;">
                        <div class="row justify-content-center mb-5">
                            <div class="col-lg-8 d-flex align-items-center" style="gap: 2rem;">
                                <!-- Profile picture with edit icon-->
                                <div class="position-relative">
                                    <img id="profileImage" class="img-account-profile rounded-circle" src="assets/img/illustrations/profiles/luminosang.png" alt="" style="height: 12rem; width: 12rem; object-fit: cover;" />
                                    <!-- hidden file input -->
                                    <input id="profileImageInput" type="file" accept="image/*" style="display: none;" />
                                    <!-- Edit icon overlay-->
                                    <button type="button" class="position-absolute bg-secondary" 
                                            style="bottom: 0; right: 0; border-radius: 50%; width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 3px solid white;"
                                            onclick="openProfileImagePicker()">
                                        <i data-feather="edit-2" style="width: 1.2rem; height: 1.2rem; color: white;"></i>
                                    </button>
                                </div>
                                <!-- Nickname display-->
                                <div class="flex-grow-1 d-flex align-items-center" style="gap: 0.75rem; max-width: 400px;">
                                    <div>
                                        <label class="small mb-1" for="displayNickname">닉네임</label>
                                        <div class="fs-5 fw-bold" id="displayNickname" th:text="${user?.nickname ?: 'lumino'}">lumino</div>
                                    </div>
                                    <div class="mt-4">
                                        <button class="btn btn-sm btn-transparent-dark" type="button" style="padding: 0.25rem;">
                                            <i data-feather="edit-2" style="width: 1rem; height: 1rem;"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 구분선 -->
                        <div class="row justify-content-center" style="margin-bottom: 1rem;">
                            <div class="col-lg-8">
                                <hr class="my-0" />
                            </div>
                        </div>
                        
                        <!-- 저장 워크스페이스 섹션 -->
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="d-flex align-items-center justify-content-between mb-3">
                                    <h5 class="mb-0">저장 워크스페이스</h5>
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="showCreateWorkspaceModal()">
                                        <i data-feather="plus" style="width: 14px; height: 14px;"></i>
                                        새 워크스페이스
                                    </button>
                                </div>
                                <hr class="my-0" />
                            </div>
                        </div>
                        
                        <!-- 워크스페이스 목록 (DB에서 가져온 워크스페이스들이 자동으로 표시됨) -->
                        <!-- 데이터베이스에서 가져온 워크스페이스 -->
                        <section th:each="workspace, iterStat : ${workspaces}"
                                 th:id="'workspace-zone-db-' + ${iterStat.index}"
                                 class="az-section">
                            <div class="card mt-4">
                                <div class="card-header d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-stack bg-secondary-soft text-secondary me-3"><i data-feather="cpu"></i></div>
                                        <div>
                                            <h5 class="mb-0" th:text="${workspace.workspaceName}">워크스페이스 이름</h5>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <!-- 수정 · 삭제 버튼 -->
                                        <button type="button"
                                                class="btn btn-sm btn-transparent-dark ws-edit-btn ms-2 me-1"
                                                th:data-wsid="${workspace.workspaceId}"
                                                th:data-wsname="${workspace.workspaceName}"
                                                title="이름 수정">
                                            <i data-feather="edit-2"></i>
                                        </button>

                                        <button type="button"
                                                class="btn btn-sm btn-transparent-danger ws-delete-btn"
                                                th:data-wsid="${workspace.workspaceId}"
                                                th:data-wsname="${workspace.workspaceName}"
                                                title="워크스페이스 삭제">
                                            <i data-feather="trash-2"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="card-body" style="overflow-x: auto;">
                                    <div class="row g-3 justify-content-start flex-nowrap">
                                        <!-- 각 tool 표시 -->
                                        <div th:each="tool : ${workspace.tools}" class="col-auto">
                                            <div class="d-flex flex-column align-items-center">
                                                <a class="card lift lift-sm text-center rounded-4" href="#" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px;">
                                                    <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                                        <!-- tool 로고 이미지 경로: /assets/img/logo_img/{tool_name}.png -->
                                                        <img th:src="@{'/assets/img/logo_img/' + ${tool.toolName} + '.png'}"
                                                             th:alt="${tool.toolName} + ' Logo'"
                                                             class="workspace-logo"
                                                             onerror="this.src='/assets/img/logo_img/default.png'" />
                                                    </div>
                                                </a>
                                                <div class="toolname" th:text="${tool.toolName}">Tool Name</div>
                                            </div>
                                        </div>

                                        <!-- Add Tool 버튼 -->
                                        <div class="col-auto">
                                            <div class="d-flex flex-column align-items-center">
                                                <a class="card lift lift-sm text-center rounded-4" href="#" style="border-radius: 1.5rem; aspect-ratio: 1 / 1; display: block; text-decoration: none; width: 130px; max-width: 130px; height: 130px;" th:onclick="'event.preventDefault(); showAddToolModal(' + ${workspace.workspaceId} + '); return false;'">
                                                    <div class="card-body d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 100%; padding: 0.5rem;">
                                                        <i class="mb-2" data-feather="plus"></i>
                                                        <div>Add Tool</div>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </main>
                
                <!-- Add Tool Modal -->
                <div class="modal fade" id="addToolModal" tabindex="-1" aria-labelledby="addToolModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addToolModalLabel">AI 도구 추가</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form id="addToolForm" onsubmit="return submitAddTool(event);">
                                <div class="modal-body">
                                    <input type="hidden" id="modalWorkspaceId" name="workspaceId" />
                                    <div class="mb-3">
                                        <label for="toolName" class="form-label">도구 이름</label>
                                        <input type="text" class="form-control" id="toolName" name="toolName" required placeholder="예: ChatGPT, DALL-E" />
                                    </div>
                                    <div class="mb-3">
                                        <label for="toolUrl" class="form-label">도구 URL</label>
                                        <input type="url" class="form-control" id="toolUrl" name="toolUrl" required placeholder="https://example.com" />
                                    </div>
                                    <div class="mb-3">
                                        <label for="toolImageFile" class="form-label">도구 로고 이미지</label>
                                        <input type="file" class="form-control" id="toolImageFile" name="toolImageFile" accept="image/*" />
                                        <div class="form-text">AI 도구의 로고 이미지를 업로드하세요. (선택사항)</div>
                                    </div>
                                    <div id="imagePreview" class="mb-3" style="display: none;">
                                        <label class="form-label">이미지 미리보기</label>
                                        <div>
                                            <img id="previewImg" src="" alt="Preview" style="max-width: 100px; max-height: 100px; border-radius: 0.5rem; border: 1px solid #dee2e6;" />
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                                    <button type="submit" class="btn btn-secondary">완료</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- (이름 수정 모달) -->
                <div class="modal fade" id="editWorkspaceModal" tabindex="-1" aria-labelledby="editWorkspaceLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="editWorkspaceForm">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editWorkspaceLabel">워크스페이스 수정</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="hidden" id="editWsId">
                                    <div class="mb-3">
                                        <label for="editWsName" class="form-label">워크스페이스 이름</label>
                                        <input type="text" class="form-control" id="editWsName" required placeholder="예: Engineering">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                    <button type="submit" class="btn btn-secondary">저장</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <footer class="footer-admin mt-auto footer-light">
                    <div class="container-xl px-4">
                        <div class="row">
                            <div class="col-md-6 small"></div>
                            <div class="col-md-6 text-md-end small">
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>

        <script>
            // Feather icons 초기화
            feather.replace();
            
            // 프로필 이미지 변경: 파일 선택 열기
            function openProfileImagePicker() {
                const input = document.getElementById('profileImageInput');
                if (!input) return;
                input.click();
                input.onchange = handleProfileImageSelected;
            }

            // 파일 선택 후 미리보기 및 업로드
            function handleProfileImageSelected(event) {
                const file = event.target.files && event.target.files[0];
                if (!file) return;

                // 미리보기
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('profileImage');
                    if (img) img.src = e.target.result;
                };
                reader.readAsDataURL(file);

                // 업로드 (선택: API 경로는 필요 시 변경)
                const formData = new FormData();
                formData.append('profileImage', file);
                fetch('/api/user/profile-image', { method: 'POST', body: formData })
                    .then(res => {
                        if (!res.ok) throw new Error('프로필 이미지 업로드 실패');
                    })
                    .catch(err => {
                        console.error(err);
                        alert('이미지 업로드 중 오류가 발생했습니다.');
                    });
            }


            // 페이지 로드 후 카테고리와 설정을 자동으로 펼치기
            document.addEventListener('DOMContentLoaded', function () {
              [
                ['#collapseDashboards', 'a.nav-link[data-bs-target="#collapseDashboards"]'],
                ['#collapseUtilities', 'a.nav-link[data-bs-target="#collapseUtilities"]']
              ].forEach(([panelSel, triggerSel]) => {
                const panel   = document.querySelector(panelSel);
                const trigger = document.querySelector(triggerSel);
                if (panel){
                  panel.classList.add('show'); // Bootstrap collapse 강제 오픈
                  panel.style.height = 'auto';
                }
                if (trigger){
                  trigger.removeAttribute('data-bs-toggle'); // 토글 비활성화
                  trigger.setAttribute('aria-expanded','true');
                }
              });
            });

            // 워크스페이스 삭제 함수
            function deleteWorkspace(workspaceId) {
                if (confirm('이 워크스페이스를 삭제하시겠습니까?')) {
                    // AJAX로 워크스페이스 삭제
                    fetch('/api/workspace/' + workspaceId, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            location.reload(); // 페이지 새로고침
                        } else {
                            alert('워크스페이스 삭제에 실패했습니다.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('워크스페이스 삭제 중 오류가 발생했습니다.');
                    });
                }
            }
            
            // 모든 워크스페이스 삭제 기능은 UI에서 제거됨
            
            // Add Tool 모달 표시 함수
            function showAddToolModal(workspaceId) {
                document.getElementById('modalWorkspaceId').value = workspaceId;
                document.getElementById('addToolForm').reset();
                document.getElementById('imagePreview').style.display = 'none';
                
                const modal = new bootstrap.Modal(document.getElementById('addToolModal'));
                modal.show();
                
                // 이미지 미리보기 이벤트 리스너
                const fileInput = document.getElementById('toolImageFile');
                fileInput.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            document.getElementById('previewImg').src = event.target.result;
                            document.getElementById('imagePreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        document.getElementById('imagePreview').style.display = 'none';
                    }
                };
            }
            
            // Add Tool 폼 제출 함수
            function submitAddTool(event) {
                event.preventDefault();
                
                const workspaceId = document.getElementById('modalWorkspaceId').value;
                const toolName = document.getElementById('toolName').value;
                const toolUrl = document.getElementById('toolUrl').value;
                const toolImageFile = document.getElementById('toolImageFile').files[0];
                
                // FormData 생성
                const formData = new FormData();
                formData.append('workspaceId', workspaceId);
                formData.append('toolName', toolName);
                formData.append('toolUrl', toolUrl);
                if (toolImageFile) {
                    formData.append('toolImageFile', toolImageFile);
                }
                
                // AJAX로 도구 추가
                fetch('/api/workspace/add-tool', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        // 모달 닫기
                        const modal = bootstrap.Modal.getInstance(document.getElementById('addToolModal'));
                        modal.hide();
                        // 페이지 새로고침
                        location.reload();
                    } else {
                        return response.json().then(data => {
                            throw new Error(data.message || '도구 추가에 실패했습니다.');
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert(error.message || '도구 추가 중 오류가 발생했습니다.');
                });
                
                return false;
            }
        </script>


                <script>
                    // 아이콘 다시 그리기(동적으로 추가된 아이콘 반영)
                    if (window.feather) feather.replace();

                    /* === 수정 모달 열기 === */
                    document.addEventListener('click', (e) => {
                      const btn = e.target.closest('.ws-edit-btn');
                      if (!btn) return;

                      const id = btn.dataset.wsid;
                      const name = btn.dataset.wsname || '';

                      document.getElementById('editWsId').value = id;
                      document.getElementById('editWsName').value = name;

                      const modal = new bootstrap.Modal(document.getElementById('editWorkspaceModal'));
                      modal.show();
                    });

                    /* === 수정 저장 (PUT /api/workspace/{id}) === */
                    document.getElementById('editWorkspaceForm').addEventListener('submit', async (e) => {
                      e.preventDefault();
                      const id = document.getElementById('editWsId').value;
                      const name = document.getElementById('editWsName').value.trim();
                      if (!name) {
                        alert('워크스페이스 이름을 입력해주세요.');
                        return;
                      }

                      try {
                        const res = await fetch(`/api/workspace/${encodeURIComponent(id)}`, {
                          method: 'PUT',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ name })
                        });
                        
                        if (!res.ok) {
                          const errorText = await res.text();
                          throw new Error(errorText || '수정 실패');
                        }

                        const result = await res.json();
                        alert('워크스페이스 이름이 성공적으로 수정되었습니다.');
                        bootstrap.Modal.getInstance(document.getElementById('editWorkspaceModal')).hide();
                        location.reload();
                      } catch (err) {
                        console.error(err);
                        alert('워크스페이스 수정 중 오류가 발생했습니다: ' + err.message);
                      }
                    });

                    /* === 삭제 (DELETE /api/workspace/{id}) === */
                    document.addEventListener('click', async (e) => {
                      const btn = e.target.closest('.ws-delete-btn');
                      if (!btn) return;

                      const id = btn.dataset.wsid;
                      const name = btn.dataset.wsname || '';

                      if (!confirm(`"${name}" 워크스페이스를 삭제하시겠습니까?\n삭제 후 되돌릴 수 없습니다.`)) return;

                      try {
                        const res = await fetch(`/api/workspace/${encodeURIComponent(id)}`, { 
                          method: 'DELETE' 
                        });
                        
                        if (!res.ok) {
                          const errorText = await res.text();
                          throw new Error(errorText || '삭제 실패');
                        }
                        
                        const result = await res.text();
                        alert('워크스페이스가 성공적으로 삭제되었습니다.');
                        location.reload();
                      } catch (err) {
                        console.error(err);
                        alert('워크스페이스 삭제 중 오류가 발생했습니다: ' + err.message);
                      }
                    });
                </script>



    </body>
</html>
